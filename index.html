<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Duck√©mon: Infinite Origin</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root { 
            --grass: #78C850; --forest: #2D5A27; --sand: #F0D060; --water: #6890F0;
            --ui-bg: #f8f8f8; --ui-border: #706880;
        }
        * { box-sizing: border-box; touch-action: manipulation; user-select: none; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #222; font-family: 'Press Start 2P', cursive; overflow: hidden; }

        /* --- THE WORLD ENGINE --- */
        #viewport { position: relative; width: 100vw; height: 100vh; overflow: hidden; border: 8px solid #000; }
        #world { position: absolute; transition: transform 0.2s linear; }
        .tile { width: 64px; height: 64px; position: absolute; }
        .t-grass { background: var(--grass); border: 1px solid rgba(0,0,0,0.05); }
        .t-forest { background: var(--forest); }
        .t-sand { background: var(--sand); }
        .t-water { background: var(--water); }

        /* --- POKEMON STYLE SPRITE --- */
        .duck-sprite {
            width: 48px; height: 48px; position: absolute;
            background-size: contain; background-repeat: no-repeat;
            image-rendering: pixelated; z-index: 1000;
            transition: left 0.2s linear, top 0.2s linear;
        }
        /* Procedural Duck Drawing via CSS */
        .pixel-art {
            width: 4px; height: 4px; background: transparent;
            box-shadow: 
                8px 4px 0 #000, 12px 4px 0 #000, 16px 4px 0 #000,
                4px 8px 0 #000, 8px 8px 0 var(--c), 12px 8px 0 var(--c), 16px 8px 0 var(--c), 20px 8px 0 #000,
                4px 12px 0 #000, 8px 12px 0 var(--c), 12px 12px 0 var(--c), 16px 12px 0 var(--c), 20px 12px 0 #e67e22,
                8px 16px 0 #000, 12px 16px 0 #000, 16px 16px 0 #000;
            transform: scale(2.5); position: absolute;
        }

        /* --- UI OVERLAYS --- */
        .screen { position: absolute; inset: 0; z-index: 2000; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .pokedex-card { 
            background: #e0e0e0; border: 6px double var(--ui-border); width: 90%; max-width: 450px; 
            padding: 20px; border-radius: 10px; text-align: center; color: #333;
        }
        .btn { 
            font-family: 'Press Start 2P'; padding: 12px; margin: 5px; 
            border: 3px solid var(--ui-border); background: #fff; cursor: pointer; font-size: 8px; 
        }
        .btn:active { background: #bbb; }

        /* --- HUD --- */
        #hud { 
            position: absolute; bottom: 0; width: 100%; background: var(--ui-bg); 
            border-top: 4px solid var(--ui-border); padding: 10px; display: flex; 
            justify-content: space-between; align-items: center; font-size: 10px; z-index: 1500;
        }

        /* --- JOYSTICK --- */
        #mobile-ctrl { position: absolute; bottom: 80px; left: 20px; display: grid; grid-template-columns: repeat(3, 50px); gap: 5px; z-index: 1600; }
    </style>
</head>
<body onload="init()">

<div id="viewport">
    <div id="world"></div>
    <div id="player-container" style="position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); z-index: 1001;">
        <div id="player-sprite" class="pixel-art" style="--c: #f1c40f;"></div>
    </div>

    <div id="custom-screen" class="screen" style="display: flex;">
        <div class="pokedex-card">
            <h2 style="font-size: 12px;">CHOOSE YOUR DUCK</h2>
            <div style="height: 100px; position: relative; margin: 20px 0;">
                <div id="preview-duck" class="pixel-art" style="--c: #f1c40f; left: 45%; top: 20%;"></div>
            </div>
            <div class="grid">
                <button class="btn" onclick="setDuck('#f1c40f')">GOLD</button>
                <button class="btn" onclick="setDuck('#ff6b6b')">FIRE</button>
                <button class="btn" onclick="setDuck('#4ecdc4')">AQUA</button>
                <button class="btn" onclick="setDuck('#9b59b6')">VOID</button>
            </div>
            <br>
            <button class="btn" style="background: #78C850; color: white;" onclick="startGame()">START ADVENTURE</button>
        </div>
    </div>

    <div id="hud">
        <div id="loc-text">ROUTE 1</div>
        <div id="bread-count">ü•ñ: 0</div>
        <button class="btn" onclick="toggleCustom()">STYLE</button>
    </div>

    <div id="mobile-ctrl">
        <div></div><button class="btn" onclick="inputMove(0, 64)">‚Üë</button><div></div>
        <button class="btn" onclick="inputMove(-64, 0)">‚Üê</button><button class="btn" onclick="inputMove(0, -64)">‚Üì</button><button class="btn" onclick="inputMove(64, 0)">‚Üí</button>
    </div>
</div>

<script>
    let p = { x: 0, y: 0, color: '#f1c40f', bread: 0 };
    let rendered = {};
    let isMoving = false;

    function init() {
        renderWorld();
        window.addEventListener('keydown', e => {
            if(isMoving) return;
            const k = e.key;
            if(k === 'ArrowUp' || k === 'w') inputMove(0, 64);
            if(k === 'ArrowDown' || k === 's') inputMove(0, -64);
            if(k === 'ArrowLeft' || k === 'a') inputMove(-64, 0);
            if(k === 'ArrowRight' || k === 'd') inputMove(64, 0);
        });
    }

    function setDuck(color) {
        p.color = color;
        document.getElementById('preview-duck').style.setProperty('--c', color);
        document.getElementById('player-sprite').style.setProperty('--c', color);
    }

    function startGame() {
        document.getElementById('custom-screen').style.display = 'none';
    }

    function toggleCustom() {
        const s = document.getElementById('custom-screen');
        s.style.display = (s.style.display === 'flex') ? 'none' : 'flex';
    }

    function inputMove(mx, my) {
        if(isMoving) return;
        isMoving = true;
        
        // Sprite Direction Flip
        if(mx !== 0) document.getElementById('player-sprite').style.transform = `scale(2.5) scaleX(${mx > 0 ? 1 : -1})`;

        p.x += mx;
        p.y += my;
        
        renderWorld();
        
        setTimeout(() => { 
            isMoving = false;
            if(Math.random() < 0.1) encounter();
        }, 200);
    }

    function renderWorld() {
        const w = document.getElementById('world');
        const buffer = 8;
        
        let curX = Math.floor(p.x / 64);
        let curY = Math.floor(p.y / 64);

        for(let i = -buffer; i < buffer; i++) {
            for(let j = -buffer; j < buffer; j++) {
                let tx = curX + i;
                let ty = curY + j;
                let id = `${tx},${ty}`;

                if(!rendered[id]) {
                    const tile = document.createElement('div');
                    tile.className = 'tile ' + getTerrain(tx, ty);
                    tile.style.left = (tx * 64) + 'px';
                    tile.style.top = (-ty * 64) + 'px';
                    w.appendChild(tile);
                    rendered[id] = true;
                }
            }
        }
        w.style.transform = `translate(${-p.x + window.innerWidth/2}px, ${p.y + window.innerHeight/2}px)`;
        updateHUD(getTerrain(curX, curY));
    }

    function getTerrain(x, y) {
        // Procedural terrain logic
        let noise = Math.abs(Math.sin(x * 0.1) + Math.cos(y * 0.1));
        if(noise > 1.4) return 't-water';
        if(noise > 1.1) return 't-forest';
        if(noise < 0.3) return 't-sand';
        return 't-grass';
    }

    function updateHUD(terrain) {
        let loc = "ROUTE 1";
        if(terrain === 't-water') loc = "CERULEAN LAKE";
        if(terrain === 't-forest') loc = "VIRIDIAN WOODS";
        if(terrain === 't-sand') loc = "DESERT ROUTE";
        document.getElementById('loc-text').innerText = loc;
    }

    function encounter() {
        p.bread += 10;
        document.getElementById('bread-count').innerText = `ü•ñ: ${p.bread}`;
        // Brief shake effect
        document.body.style.backgroundColor = "#fff";
        setTimeout(() => document.body.style.backgroundColor = "#222", 50);
    }
</script>
</body>
</html>
