<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duck Quest: Persistent RPG</title>
    <style>
        :root { --water: #4cc9f0; --gold: #ffb703; --boss: #e63946; }
        body { font-family: 'Courier New', Courier, monospace; background: #222; color: white; text-align: center; margin: 0; overflow: hidden; }
        
        #ui-bar { background: #333; padding: 15px; display: flex; justify-content: space-around; border-bottom: 4px solid var(--water); }
        .stat-box { font-weight: bold; font-size: 1.2rem; }
        
        #game-world { position: relative; width: 90vw; height: 50vh; background: var(--water); margin: 20px auto; border-radius: 20px; border: 8px solid #0077b6; overflow: hidden; }
        .boss-active { background: var(--boss) !important; animation: shake 0.5s infinite; }

        @keyframes shake { 0% { transform: translate(1px, 1px); } 50% { transform: translate(-1px, -2px); } 100% { transform: translate(1px, 1px); } }

        .duck, .boss { position: absolute; cursor: pointer; user-select: none; }
        .duck { font-size: 50px; }
        .boss { font-size: 150px; }

        #boss-hp-container { display: none; width: 80%; background: #555; height: 20px; margin: 10px auto; border-radius: 10px; }
        #boss-hp-fill { background: #ff0000; width: 100%; height: 100%; border-radius: 10px; }

        #shop { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
        .btn { background: var(--gold); border: none; padding: 10px; border-radius: 8px; cursor: pointer; font-weight: bold; margin-bottom: 5px; }
        
        #save-note { color: #b5e48c; font-size: 0.8rem; margin-top: 5px; opacity: 0; transition: opacity 0.5s; }
    </style>
</head>
<body>

    <div id="ui-bar">
        <div>‚≠ê Lvl: <span id="lvl">1</span></div>
        <div>üçû Bread: <span id="bread">0</span></div>
        <div>üìà XP: <span id="xp">0</span>/<span id="next-lvl">10</span></div>
    </div>

    <h2 id="status-msg">Quack to start!</h2>
    <div id="boss-hp-container"><div id="boss-hp-fill"></div></div>

    <div id="game-world"></div>

    <div id="shop">
        <button class="btn" onclick="buyUpgrade('click')">Net (+1 Power) - <span id="cost-click">15</span>ü•ñ</button>
        <button class="btn" onclick="buyUpgrade('auto')">Auto-Trap (+1 Speed) - <span id="cost-auto">60</span>ü•ñ</button>
        <button class="btn" style="background:#ff4d4d" onclick="resetGame()">Hard Reset</button>
    </div>
    <div id="save-note">Progress Saved!</div>

    <script>
        // --- INITIAL STATE ---
        let stats = {
            bread: 0,
            xp: 0,
            lvl: 1,
            xpToNext: 10,
            clickPower: 1,
            autoLevel: 0,
            isBossMode: false
        };

        // --- CORE FUNCTIONS ---
        function init() {
            const savedData = localStorage.getItem('duckQuestSave');
            if (savedData) {
                stats = JSON.parse(savedData);
                // Restart auto-catchers based on saved level
                for(let i=0; i < stats.autoLevel; i++) {
                    setInterval(() => { if(!stats.isBossMode) gainXP(1); }, 2000);
                }
            }
            updateUI();
        }

        function saveGame() {
            localStorage.setItem('duckQuestSave', JSON.stringify(stats));
            const note = document.getElementById('save-note');
            note.style.opacity = 1;
            setTimeout(() => note.style.opacity = 0, 2000);
        }

        function updateUI() {
            document.getElementById('bread').innerText = stats.bread;
            document.getElementById('xp').innerText = stats.xp;
            document.getElementById('lvl').innerText = stats.lvl;
            document.getElementById('next-lvl').innerText = stats.xpToNext;
            document.getElementById('cost-click').innerText = 15 + (stats.clickPower * 5);
            document.getElementById('cost-auto').innerText = 60 + (stats.autoLevel * 20);
        }

        function createDuck() {
            if (stats.isBossMode) return;
            const world = document.getElementById('game-world');
            const duck = document.createElement('div');
            duck.className = 'duck';
            duck.innerHTML = 'ü¶Ü';
            duck.style.left = Math.random() * 80 + '%';
            duck.style.top = Math.random() * 80 + '%';

            duck.onclick = () => {
                gainXP(stats.clickPower);
                stats.bread += Math.floor(Math.random() * 3) + 1;
                duck.remove();
                updateUI();
                saveGame(); // Save every time they make progress
            };
            world.appendChild(duck);
            setTimeout(() => duck.remove(), 2000);
        }

        function gainXP(amount) {
            stats.xp += amount;
            if (stats.xp >= stats.xpToNext) {
                stats.lvl++;
                stats.xp = 0;
                stats.xpToNext = Math.floor(stats.xpToNext * 1.8);
                if (stats.lvl % 5 === 0) startBossBattle();
            }
            updateUI();
        }

        function startBossBattle() {
            stats.isBossMode = true;
            const world = document.getElementById('game-world');
            world.classList.add('boss-active');
            document.getElementById('status-msg').innerText = "‚ö†Ô∏è ELITE SWAN ‚ö†Ô∏è";
            document.getElementById('boss-hp-container').style.display = "block";
            
            let bossHP = 100 + (stats.lvl * 20);
            let currentHP = bossHP;
            
            const boss = document.createElement('div');
            boss.className = 'boss';
            boss.innerHTML = 'ü¶¢';
            boss.style.left = '35%'; boss.style.top = '10%';
            
            boss.onclick = () => {
                currentHP -= (stats.clickPower * 5);
                document.getElementById('boss-hp-fill').style.width = (currentHP / bossHP) * 100 + '%';
                if (currentHP <= 0) {
                    stats.isBossMode = false;
                    stats.bread += (stats.lvl * 20);
                    world.classList.remove('boss-active');
                    document.getElementById('boss-hp-container').style.display = "none";
                    document.getElementById('status-msg').innerText = "Victory! Bread Looted.";
                    boss.remove();
                    saveGame();
                }
            };
            world.appendChild(boss);
        }

        function buyUpgrade(type) {
            if (type === 'click' && stats.bread >= (15 + (stats.clickPower * 5))) {
                stats.bread -= (15 + (stats.clickPower * 5));
                stats.clickPower++;
            } else if (type === 'auto' && stats.bread >= (60 + (stats.autoLevel * 20))) {
                stats.bread -= (60 + (stats.autoLevel * 20));
                stats.autoLevel++;
                setInterval(() => { if(!stats.isBossMode) gainXP(1); }, 2000);
            }
            updateUI();
            saveGame();
        }

        function resetGame() {
            if(confirm("Clear all your bread and levels?")) {
                localStorage.removeItem('duckQuestSave');
                location.reload();
            }
        }

        // Run game
        init();
        setInterval(createDuck, 1000);
    </script>
</body>
</html>
