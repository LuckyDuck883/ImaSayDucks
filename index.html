<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DuckÃ©mon: Pixel Legend</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root { 
            --grass: #4caf50; --water: #2196f3; --sand: #f4d03f; --gym: #8e44ad;
            --p-yellow: #f1c40f; --p-orange: #e67e22;
        }
        
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            background: #111; font-family: 'Press Start 2P', cursive; 
            color: #fff; overflow: hidden; image-rendering: pixelated;
        }

        /* --- THE WORLD --- */
        #viewport { position: relative; width: 100vw; height: 100vh; overflow: hidden; }
        #map { position: absolute; display: grid; transition: 0.15s steps(4, end); }
        
        /* Pixel Tiles */
        .tile { width: 64px; height: 64px; position: relative; }
        .t-grass { background: var(--grass); box-shadow: inset 4px 4px 0 #3d8b40; }
        .t-water { background: var(--water); box-shadow: inset 4px 4px 0 #1976d2; }
        .t-sand { background: var(--sand); box-shadow: inset 4px 4px 0 #d4ac0d; }

        /* --- PIXEL ART DUCK (CSS PIXELS) --- */
        .pixel-duck {
            width: 8px; height: 8px;
            background: transparent;
            /* Creating a 8x8 pixel duck using box-shadows */
            box-shadow: 
                /* Head & Body */
                16px 8px 0 var(--c), 24px 8px 0 var(--c), 32px 8px 0 var(--c),
                16px 16px 0 var(--c), 24px 16px 0 var(--c), 32px 16px 0 var(--c), 40px 16px 0 #e67e22,
                8px 24px 0 var(--c), 16px 24px 0 var(--c), 24px 24px 0 var(--c), 32px 24px 0 var(--c),
                8px 32px 0 var(--c), 16px 32px 0 var(--c), 24px 32px 0 var(--c), 32px 32px 0 var(--c),
                /* Eye */
                32px 8px 0 #000;
            position: absolute; transform: scale(4);
        }

        #player { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); z-index: 100; pointer-events: none; }

        /* --- OVERLAYS --- */
        .screen { display: none; position: absolute; inset: 0; z-index: 1000; background: #000; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .shop-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        
        /* --- UI ELEMENTS --- */
        #hud { position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.85); border-top: 4px solid #fff; padding: 20px; display: flex; justify-content: space-between; z-index: 500; font-size: 12px; }
        .btn { font-family: 'Press Start 2P'; padding: 15px; background: #fff; color: #000; border: 4px solid #777; cursor: pointer; }
        .btn:hover { background: #ccc; }
        .hp-bar { width: 400px; height: 24px; border: 4px solid #fff; background: #333; margin: 10px 0; }
        .hp-fill { height: 100%; background: #2ecc71; width: 100%; transition: 0.3s; }
    </style>
</head>
<body onload="init()">

<div id="viewport">
    <div id="map"></div>
    <div id="player"><div class="pixel-duck" style="--c:var(--p-yellow)"></div></div>

    <div id="battle-screen" class="screen">
        <h1 id="b-title">WILD DUCK ENCOUNTER</h1>
        <div id="e-sprite" style="margin: 80px 0;"></div>
        <div class="hp-bar"><div id="e-hp" class="hp-fill"></div></div>
        <div class="hp-bar"><div id="p-hp" class="hp-fill"></div></div>
        <div style="display:flex; gap:10px;">
            <button class="btn" onclick="attack()">QUACK ATTACK</button>
            <button class="btn" onclick="useItem()">ULTRA BREAD (<span id="inv-count">0</span>)</button>
        </div>
    </div>

    <div id="shop-screen" class="screen">
        <h1>POKÃ‰-DUCK MART</h1>
        <p>BREAD: <span id="shop-bread">0</span></p>
        <div class="shop-grid">
            <div style="border:2px solid #fff; padding:10px; text-align:center;">
                <p>ULTRA BREAD</p>
                <p>50ðŸ¥–</p>
                <button class="btn" onclick="buyItem()">BUY</button>
            </div>
        </div>
        <button class="btn" style="margin-top:20px;" onclick="closeAll()">EXIT SHOP</button>
    </div>

    <div id="hud">
        <div>LVL: <span id="lvl">1</span> | BREAD: <span id="bread">0</span></div>
        <div>WASD TO MOVE | B FOR SHOP</div>
    </div>
</div>

<script>
    let world = { x: 0, y: 0 };
    let player = { lvl: 1, hp: 100, bread: 100, items: 0 };
    let enemy = null;
    const step = 64;

    function init() {
        const map = document.getElementById('map');
        map.style.gridTemplateColumns = `repeat(40, ${step}px)`;
        for(let i=0; i<1600; i++) {
            const t = document.createElement('div');
            // Biome logic: Central area is grass, edges are water/sand
            let type = 't-grass';
            if (i < 80 || i > 1520) type = 't-water';
            else if (i % 40 < 2 || i % 40 > 37) type = 't-sand';
            t.className = 'tile ' + type;
            map.appendChild(t);
        }
        window.addEventListener('keydown', handleMove);
        update();
    }

    function handleMove(e) {
        if(document.querySelector('.screen[style*="display: flex"]')) return;
        const k = e.key.toLowerCase();
        if(k === 'w') world.y += step;
        if(k === 's') world.y -= step;
        if(k === 'a') world.x += step;
        if(k === 'd') world.x -= step;
        if(k === 'b') openShop();
        
        if(['w','a','s','d'].includes(k)) {
            if(Math.random() < 0.08) startBattle();
            update();
        }
    }

    function startBattle() {
        const scr = document.getElementById('battle-screen');
        scr.style.display = 'flex';
        enemy = { hp: 100,
