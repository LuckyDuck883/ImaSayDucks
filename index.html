<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DuckÃ©mon: Nexus</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root { 
            --grass: #78C850; --forest: #45a049; --sand: #F0D060; --water: #6890F0;
            --ui-bg: #f8f8f8; --ui-border: #706880; --pokedred: #ff1111;
        }
        * { box-sizing: border-box; touch-action: manipulation; user-select: none; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; font-family: 'Press Start 2P', cursive; overflow: hidden; }

        /* --- WORLD --- */
        #viewport { position: relative; width: 100vw; height: 100vh; overflow: hidden; }
        #world { position: absolute; transition: transform 0.2s linear; }
        .tile { width: 64px; height: 64px; position: absolute; }
        .t-grass { background: var(--grass); border: 1px solid rgba(0,0,0,0.03); }
        .t-forest { background: var(--forest); background-image: radial-gradient(#2D5A27 15%, transparent 15%); background-size: 8px 8px; }
        .t-sand { background: var(--sand); }
        .t-water { background: var(--water); }

        /* --- ENTITIES --- */
        .pixel-art {
            width: 4px; height: 4px; background: transparent;
            box-shadow: 8px 4px 0 #000, 12px 4px 0 #000, 16px 4px 0 #000, 4px 8px 0 #000, 8px 8px 0 var(--c), 12px 8px 0 var(--c), 16px 8px 0 var(--c), 20px 8px 0 #000, 4px 12px 0 #000, 8px 12px 0 var(--c), 12px 12px 0 var(--c), 16px 12px 0 var(--c), 20px 12px 0 #e67e22, 8px 16px 0 #000, 12px 16px 0 #000, 16px 16px 0 #000;
            transform: scale(3); position: absolute; transition: all 0.2s linear;
        }
        .tall-grass-clip { clip-path: inset(0% 0% 35% 0%); }
        #player-container { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); z-index: 1000; }

        /* --- CHAT SYSTEM --- */
        #chat-box { position: absolute; bottom: 80px; left: 10px; width: 250px; height: 150px; background: rgba(0,0,0,0.7); border: 2px solid #fff; z-index: 2000; display: flex; flex-direction: column; padding: 5px; }
        #chat-log { flex-grow: 1; overflow-y: auto; font-size: 6px; color: #fff; margin-bottom: 5px; line-height: 1.4; }
        #chat-input { background: #000; border: 1px solid #fff; color: #fff; font-family: 'Press Start 2P'; font-size: 6px; padding: 5px; outline: none; }

        /* --- INVENTORY --- */
        .screen { position: absolute; inset: 0; z-index: 3000; display: none; background: rgba(0,0,0,0.85); align-items: center; justify-content: center; }
        .modal { background: var(--ui-bg); border: 6px double var(--ui-border); padding: 20px; width: 90%; max-width: 400px; color: #333; }
        .inv-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin: 15px 0; }
        .inv-slot { width: 100%; aspect-ratio: 1; background: #ddd; border: 2px solid #777; display: flex; align-items: center; justify-content: center; position: relative; }

        /* --- BATTLE --- */
        #battle-screen { background: #98D8D8; flex-direction: column; }
        .hp-plate { background: #fff; border: 3px solid #333; padding: 8px; width: 140px; font-size: 7px; }
        .hp-fill { height: 6px; background: #4CAF50; width: 100%; transition: width 0.3s; }

        /* --- HUD --- */
        #hud { position: absolute; top: 10px; width: 100%; display: flex; justify-content: space-around; font-size: 8px; z-index: 1500; background: rgba(255,255,255,0.8); padding: 10px; border-bottom: 3px solid #333; }
        .btn { font-family: 'Press Start 2P'; font-size: 8px; padding: 8px; cursor: pointer; border: 3px solid #333; }
    </style>
</head>
<body onload="init()">

<div id="viewport">
    <div id="world"></div>
    <div id="player-container"><div id="p-sprite" class="pixel-art" style="--c:#f1c40f"></div></div>

    <div id="hud">
        <span>ðŸ¥–: <span id="bread">0</span></span>
        <span>LVL: <span id="lvl">1</span></span>
        <button class="btn" onclick="toggleScreen('inv-screen')">BAG</button>
    </div>

    <div id="chat-box">
        <div id="chat-log"></div>
        <input type="text" id="chat-input" placeholder="SAY SOMETHING..." onkeydown="if(event.key==='Enter') sendChat()">
    </div>

    <div id="inv-screen" class="screen">
        <div class="modal">
            <h2 style="font-size:10px;">INVENTORY</h2>
            <div class="inv-grid" id="inventory-slots"></div>
            <button class="btn" onclick="toggleScreen('inv-screen')">CLOSE</button>
        </div>
    </div>

    <div id="battle-screen" class="screen">
        <div style="flex:1; display:flex; justify-content:space-around; align-items:center; width:100%;">
            <div class="hp-plate">WILD DUCK<div style="background:#ccc; height:6px;"><div id="e-hp" class="hp-fill"></div></div></div>
            <div id="e-sprite-battle" class="pixel-art" style="position:relative; transform:scale(6)"></div>
        </div>
        <div style="flex:1; display:flex; flex-direction:column; background:#fff; width:100%; padding:20px; border-top:5px solid #333;">
            <div class="inv-grid">
                <button class="btn" onclick="battleAction('tackle')">TACKLE</button>
                <button class="btn" onclick="battleAction('catch')">CATCH</button>
                <button class="btn" onclick="battleAction('run')">RUN</button>
            </div>
        </div>
    </div>
</div>

<script>
    let player = { x: 0, y: 0, c: '#f1c40f', bread: 100, lvl: 1, inv: [] };
    let enemy = { hp: 100, c: '#ff0000' };
    let rendered = {};

    const BOTS = ["Ash_Duck", "DuckoMode", "WaddleWarrior", "Gary_Quack"];
    const QUOTES = ["Just found a Flame Duck!", "Anyone want to trade?", "This route is infinite...", "Quack!"];

    function init() {
        renderWorld();
        setupInventory();
        setInterval(botChat, 5000);
        window.addEventListener('keydown', e => {
            if(document.activeElement.id === 'chat-input') return;
            const k = e.key.toLowerCase();
            if(['w','a','s','d','arrowup','arrowdown','arrowleft','arrowright'].includes(k)) {
                let mx=0, my=0;
                if(k==='w'||k==='arrowup') my=64; if(k==='s'||k==='arrowdown') my=-64;
                if(k==='a'||k==='arrowleft') mx=-64; if(k==='d'||k==='arrowright') mx=64;
                move(mx, my);
            }
        });
    }

    function move(mx, my) {
        player.x += mx; player.y += my;
        if(mx !== 0) document.getElementById('p-sprite').style.transform = `scale(3) scaleX(${mx > 0 ? 1 : -1})`;
        renderWorld();
        
        let tx = Math.floor(player.x/64), ty = Math.floor(player.y/64);
        let t = getTerrain(tx, ty);
        document.getElementById('p-sprite').className = (t==='t-forest') ? 'pixel-art tall-grass-clip' : 'pixel-art';
        if(t==='t-forest' && Math.random() < 0.1) startBattle();
    }

    function renderWorld() {
        const w = document.getElementById('world');
        const cx = Math.floor(player.x/64), cy = Math.floor(player.y/64);
        for(let i=-7; i<=7; i++) {
            for(let j=-7; j<=7; j++) {
                let tx = cx+i, ty = cy+j;
                if(!rendered[`${tx},${ty}`]) {
                    const div = document.createElement('div');
                    div.className = `tile ${getTerrain(tx, ty)}`;
                    div.style.left = tx*64+'px'; div.style.top = -ty*64+'px';
                    w.appendChild(div); rendered[`${tx},${ty}`] = true;
                }
            }
        }
        w.style.transform = `translate(${-player.x + window.innerWidth/2}px, ${player.y + window.innerHeight/2}px)`;
    }

    function getTerrain(x, y) {
        let n = Math.abs(Math.sin(x*0.1) + Math.cos(y*0.1));
        if(n > 1.3) return 't-water';
        if(n > 1.0) return 't-forest';
        if(n < 0.3) return 't-sand';
        return 't-grass';
    }

    // --- SYSTEMS ---
    function setupInventory() {
        const grid = document.getElementById('inventory-slots');
        grid.innerHTML = '';
        for(let i=0; i<12; i++) {
            let slot = document.createElement('div');
            slot.className = 'inv-slot';
            if(player.inv[i]) {
                slot.innerHTML = `<div class="pixel-art" style="--c:${player.inv[i]}; transform:scale(1.5); position:relative;"></div>`;
            }
            grid.appendChild(slot);
        }
    }

    function sendChat() {
        const input = document.getElementById('chat-input');
        if(input.value.trim()) {
            addChat("YOU", input.value);
            input.value = "";
        }
    }

    function addChat(user, msg) {
        const log = document.getElementById('chat-log');
        log.innerHTML += `<div><span style="color:#f1c40f">${user}:</span> ${msg}</div>`;
        log.scrollTop = log.scrollHeight;
    }

    function botChat() {
        const bot = BOTS[Math.floor(Math.random()*BOTS.length)];
        const msg = QUOTES[Math.floor(Math.random()*QUOTES.length)];
        addChat(bot, msg);
    }

    function startBattle() {
        enemy.hp = 100;
        enemy.c = ['#ff6b6b','#4ecdc4','#9b59b6','#fff'][Math.floor(Math.random()*4)];
        document.getElementById('battle-screen').style.display = 'flex';
        document.getElementById('e-sprite-battle').style.setProperty('--c', enemy.c);
        updateBattleUI();
    }

    function battleAction(type) {
        if(type === 'tackle') {
            enemy.hp -= 30;
            if(enemy.hp <= 0) { alert("Victory!"); player.bread += 50; endBattle(); }
        } else if(type === 'catch') {
            if(enemy.hp < 50 && Math.random() > 0.4) {
                alert("Caught!"); player.inv.push(enemy.c); setupInventory(); endBattle();
            } else alert("It broke free!");
        } else endBattle();
        updateBattleUI();
    }

    function updateBattleUI() {
        document.getElementById('e-hp').style.width = enemy.hp + '%';
        document.getElementById('bread').innerText = player.bread;
    }

    function endBattle() { document.getElementById('battle-screen').style.display = 'none'; }
    function toggleScreen(id) { 
        const s = document.getElementById(id); 
        s.style.display = (s.style.display==='flex') ? 'none' : 'flex'; 
    }
</script>
</body>
</html>
